<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†ç«¯ - è´¦å·ä¸æˆå‘˜</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f6f7fb; }
        .container { max-width: 1000px; margin: 24px auto; padding: 0 16px; }
        .card { background: #fff; border: 1px solid #e5e7eb; border-radius: 10px; padding: 16px; margin-bottom: 16px; }
        .title { font-size: 18px; font-weight: 600; margin-bottom: 12px; }
        .row { display: flex; gap: 12px; align-items: center; margin-bottom: 8px; }
        input, select { padding: 8px; border: 1px solid #e5e7eb; border-radius: 6px; }
        button { padding: 8px 12px; border: 1px solid #e5e7eb; background: #4f46e5; color: #fff; border-radius: 6px; cursor: pointer; }
        button.secondary { background: #10b981; }
        .note { font-size: 12px; color: #6b7280; margin-top: 6px; }
        .status { font-size: 12px; color: #374151; margin-top: 6px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <div class="title">ğŸ” ç®¡ç†å‘˜ç™»å½•çŠ¶æ€</div>
            <div id="authStatus" class="status">æœªæ£€æµ‹</div>
            <div class="note">è¯¥é¡µé¢ä¼šå°†æµè§ˆå™¨ localStorage ä¸­çš„ access_token ä½œä¸º Authorization å¤´ä½¿ç”¨ã€‚</div>
        </div>

        <div class="grid">
            <div class="card">
                <div class="title">ğŸ‘¤ åˆ›å»ºç”¨æˆ·</div>
                <div class="row">
                    <input id="newUsername" placeholder="ç”¨æˆ·å" />
                    <input id="newPassword" placeholder="å¯†ç " type="password" />
                    <input id="newEmail" placeholder="é‚®ç®±ï¼ˆå¯é€‰ï¼‰" />
                </div>
                <button onclick="createUserDemo()">åˆ›å»º</button>
                <div class="note">éœ€è¦ç®¡ç†å‘˜æƒé™ã€‚è¯·å…ˆåœ¨ç™»å½•é¡µä½¿ç”¨ç®¡ç†å‘˜è´¦å·ç™»å½•ã€‚</div>
                <div id="userCreateStatus" class="status"></div>
            </div>

            <div class="card">
                <div class="title">ğŸ‘¥ ç»™é¡¹ç›®æ·»åŠ æˆå‘˜</div>
                <div class="row">
                    <input id="projectId" placeholder="é¡¹ç›®ID" />
                </div>
                <div class="row">
                    <input id="memberUsername" placeholder="ç”¨æˆ·å" />
                    <select id="memberRole">
                        <option value="viewer">viewer</option>
                        <option value="editor">editor</option>
                        <option value="owner">owner</option>
                    </select>
                </div>
                <button class="secondary" onclick="addMember()">æ·»åŠ æˆå‘˜</button>
                <div id="memberStatus" class="status"></div>
                <div class="note">ä»…é¡¹ç›® owner å¯æ“ä½œã€‚è¯¥æ“ä½œä¼šé€šè¿‡ 3003 ä»£ç†è½¬å‘åˆ° 8000 çš„æˆå‘˜æ¥å£ã€‚</div>
            </div>
        </div>
    </div>

    <script>
        function getAuthHeader() {
            const token = localStorage.getItem('access_token');
            return token ? { 'Authorization': `Bearer ${token}` } : {};
        }

        (function init() {
            const token = localStorage.getItem('access_token');
            const s = document.getElementById('authStatus');
            if (!token) {
                s.textContent = 'æœªæ£€æµ‹åˆ° access_tokenï¼Œæ­£åœ¨è·³è½¬åˆ°ç™»å½•é¡µ...';
                setTimeout(() => { window.location.href = '/'; }, 500);
                return;
            }
            s.textContent = 'å·²æ£€æµ‹åˆ° access_tokenï¼Œå°†ç”¨äºè°ƒç”¨åå°æ¥å£';
        })();

        async function createUserDemo() {
            const username = document.getElementById('newUsername').value.trim();
            const password = document.getElementById('newPassword').value.trim();
            const email = document.getElementById('newEmail').value.trim();
            const st = document.getElementById('userCreateStatus');
            st.textContent = 'â³ æäº¤ä¸­...';
            try {
                const resp = await fetch('/api/admin/users', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', ...getAuthHeader() },
                    body: JSON.stringify({ username, password, email })
                });
                const data = await resp.json();
                st.textContent = (resp.ok && data.success) ? 'âœ… åˆ›å»ºæˆåŠŸ' : `âŒ ${data.error || 'å¤±è´¥'}`;
            } catch (e) {
                st.textContent = `âŒ ${e.message}`;
            }
        }

        async function addMember() {
            const projectId = document.getElementById('projectId').value.trim();
            const username = document.getElementById('memberUsername').value.trim();
            const role = document.getElementById('memberRole').value;
            const st = document.getElementById('memberStatus');
            st.textContent = 'â³ æäº¤ä¸­...';
            try {
                const resp = await fetch(`/api/admin/projects/${encodeURIComponent(projectId)}/members`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', ...getAuthHeader() },
                    body: JSON.stringify({ username, role })
                });
                const data = await resp.json();
                st.textContent = (resp.ok && data.success) ? 'âœ… æ·»åŠ æˆåŠŸ' : `âŒ ${data.error || 'å¤±è´¥'}`;
            } catch (e) {
                st.textContent = `âŒ ${e.message}`;
            }
        }
    </script>
</body>
</html>


