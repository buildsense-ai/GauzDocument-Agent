# ReactAgent MCP客户端系统架构图

## 整体架构

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   前端界面      │    │   Web服务器     │    │  ReAct Agent    │
│  (Frontend)     │◄──►│  (web-server.js)│◄──►│   (Python)      │
│                 │    │                 │    │                 │
│ • 文件上传      │    │ • 静态文件服务  │    │ • 推理引擎      │
│ • 聊天界面      │    │ • API路由       │    │ • 工具执行      │
│ • 状态管理      │    │ • 文件处理      │    │ • PDF解析       │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                                │
                                ▼
                       ┌─────────────────┐
                       │   本地存储      │
                       │  (uploads/)     │
                       │                 │
                       │ • 文件存储      │
                       │ • 路径管理      │
                       └─────────────────┘
```

## 文件处理流程

```
1. 文件上传
   ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
   │   用户上传  │───►│ 前端验证    │───►│ 服务器接收  │
   │   PDF文件   │    │ 文件类型    │    │ multer处理  │
   └─────────────┘    │ 文件大小    │    └─────────────┘
                      └─────────────┘
                                                      │
                                                      ▼
   ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
   │ 返回文件    │◄───│ 本地存储    │◄───│ 文件名处理  │
   │ 信息        │    │ uploads/    │    │ 时间戳+清理 │
   └─────────────┘    └─────────────┘    └─────────────┘

2. PDF解析
   ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
   │ 用户请求    │───►│ 路径验证    │───►│ ReAct Agent │
   │ 解析PDF     │    │ 文件存在    │    │ 推理处理    │
   └─────────────┘    └─────────────┘    └─────────────┘
                                                      │
                                                      ▼
   ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
   │ 返回解析    │◄───│ 结构化结果  │◄───│ PDF解析工具 │
   │ 结果        │    │ JSON格式    │    │ pdf_parser  │
   └─────────────┘    └─────────────┘    └─────────────┘
```

## 核心组件关系

```
┌─────────────────────────────────────────────────────────────┐
│                    前端层 (Frontend)                        │
├─────────────────────────────────────────────────────────────┤
│ • index.html - 主界面                                       │
│ • script.js - 交互逻辑                                      │
│ • style.css - 样式定义                                      │
└─────────────────────────────────────────────────────────────┘
                                │ HTTP/WebSocket
                                ▼
┌─────────────────────────────────────────────────────────────┐
│                   Web服务器层 (Node.js)                     │
├─────────────────────────────────────────────────────────────┤
│ • web-server.js - 主服务器                                  │
│ • MCPClient.js - MCP客户端                                  │
│ • MinIOHelper.js - 存储助手                                 │
│ • config.js - 配置管理                                      │
└─────────────────────────────────────────────────────────────┘
                                │ MCP协议
                                ▼
┌─────────────────────────────────────────────────────────────┐
│                ReAct Agent层 (Python)                       │
├─────────────────────────────────────────────────────────────┤
│ • reactagent-mcp-server.py - MCP服务器                     │
│ • 工具注册表 - 工具管理                                     │
│ • PDF解析器 - 文档处理                                      │
│ • 推理引擎 - 智能分析                                       │
└─────────────────────────────────────────────────────────────┘
                                │ 文件系统
                                ▼
┌─────────────────────────────────────────────────────────────┐
│                    存储层 (Storage)                         │
├─────────────────────────────────────────────────────────────┤
│ • uploads/ - 文件上传目录                                   │
│ • generated_docs/ - 生成文档                                │
│ • rag_storage/ - 向量存储                                   │
│ • templates_storage/ - 模板存储                             │
└─────────────────────────────────────────────────────────────┘
```

## 数据流向

```
用户操作 → 前端验证 → Web服务器 → MCP协议 → ReAct Agent → 工具执行 → 结果返回
    │         │         │         │         │         │         │
    ▼         ▼         ▼         ▼         ▼         ▼         ▼
文件选择   类型检查   路径处理   消息传输   推理分析   具体工具   结构化结果
    │         │         │         │         │         │         │
    ▼         ▼         ▼         ▼         ▼         ▼         ▼
文件上传   大小验证   本地存储   协议封装   问题理解   功能执行   用户展示
```

## 工具集成架构

```
┌─────────────────────────────────────────────────────────────┐
│                    工具注册表                               │
├─────────────────────────────────────────────────────────────┤
│ • rag_tool - 文档检索问答                                   │
│ • professional_document_tool - 专业文档处理                 │
│ • template_classifier - 模板分类                            │
│ • image_rag_tool - 图片检索                                 │
│ • image_document_generator - 图片文档生成                   │
│ • pdf_parser - PDF智能解析                                  │
└─────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────┐
│                    ReAct Agent                              │
├─────────────────────────────────────────────────────────────┤
│ • 问题分析 → 工具选择 → 参数准备 → 执行调用 → 结果处理       │
└─────────────────────────────────────────────────────────────┘
```

## 关键技术栈

- **前端**: HTML5 + CSS3 + JavaScript (ES6+)
- **后端**: Node.js + Express.js
- **AI引擎**: Python + FastAPI + ReAct Agent
- **协议**: Model Context Protocol (MCP)
- **存储**: 本地文件系统 + MinIO (可选)
- **通信**: HTTP/HTTPS + WebSocket 